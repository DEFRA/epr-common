pr: none
trigger:
  branches:
    include:
    - '*'
  paths:
    include:
    - 'src/EPR.Common/EPR.Common.Logging/'
    exclude:
    - 'src/EPR.Common/EPR.Common.Authorization/'
    - 'src/EPR.Common/EPR.Common.Functions/'

parameters:

  - name: dotnetVersion
    value: dotnetVersion8


pool: DEFRA-COMMON-ubuntu2004-SSV3

variables:
  NUGET_ENABLE_LEGACY_CSPROJ_PACK: true
  NUGET_PACKAGES: $(Pipeline.Workspace)/.nuget/packages

#steps:
#  - task: UseDotNet@2
#    displayName: 'Use .NET Core 8'
#    inputs:
#      version: 8.0.x

steps:
  - script: |
      dotnet --list-sdks
      if [ "${{ parameters.dotnetVersion }}" == "dotnetVersion8" ]; then
        echo '{"sdk":{"version":"8.0.303","rollForward":"latestFeature","allowPrerelease":false}}' > ${{ parameters.solutionFolder }}/global.json
        cat ${{ parameters.solutionFolder }}/global.json
      else
        echo '{"sdk":{"version":"6.0.424","rollForward":"latestFeature","allowPrerelease":false}}' > ${{ parameters.solutionFolder }}/global.json
        cat ${{ parameters.solutionFolder }}/global.json
      fi

  - template: templates/template-build-test.yaml
    parameters:
      versionVariableGroupName: EPR.Common.Logging
      solutionFolder: src/EPR.Common/
      solutionName: EPR.Common
      projectName: EPR.Common.Logging
      runTests: true
      testProjectName: EPR.Common.Logging.Tests